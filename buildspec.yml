version: 0.2

phases:
  build:
    commands:
      # install rust and cargo
      # -y option to accept default configuration
      - curl https://sh.rustup.rs -sSf | sh -s -- -y

      # configure shell so we can use "cargo" command
      - . "$HOME/.cargo/env"     

      # reference cargo directly
      - cargo --version

      # install cargo-lambda
      - brew tap cargo-lambda/cargo-lambda
      - brew install cargo-lambda

      # build the lambda
      - cd hem-lambda
      - ~/.cargo/bin/cargo lambda build --arm64 -r --package=hem-lambda
      
  post_build:
    commands:
      - echo "Running post_build commands"